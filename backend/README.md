# RTMP → RTSP Конвертер

Сервис для конвертации видеопотоков из формата RTMP в формат RTSP.

## Описание

Этот сервис позволяет:
- Принимать видеопотоки в формате RTMP
- Конвертировать их в формат RTSP
- Предоставлять доступ к RTSP-потокам
- Управлять несколькими потоками одновременно

## Требования

- Node.js (версия 16+)
- FFmpeg
- Docker и Docker Compose (опционально)

## Установка

### Локальная установка

1. Клонировать репозиторий:
```
git clone <repository-url>
cd rtmp-rtsp-converter
```

2. Установить зависимости:
```
npm install
```

3. Собрать проект:
```
npm run build
```

4. Запустить сервис:
```
npm start
```

### Установка с использованием Docker

1. Клонировать репозиторий:
```
git clone <repository-url>
cd rtmp-rtsp-converter
```

2. Запустить с помощью Docker Compose:
```
docker-compose up -d
```

## Использование

### Веб-интерфейс

После запуска сервиса, веб-интерфейс доступен по адресу:
```
http://localhost:3000
```

Через веб-интерфейс можно:
- Создавать новые потоки
- Управлять существующими потоками
- Получать RTMP и RTSP URL для каждого потока

### API

Сервис предоставляет REST API для управления потоками:

- `GET /api/streams` - получить список всех потоков
- `GET /api/streams/:id` - получить информацию о конкретном потоке
- `POST /api/streams` - создать новый поток
- `POST /api/streams/:id/start` - запустить конвертацию потока
- `POST /api/streams/:id/stop` - остановить конвертацию потока
- `DELETE /api/streams/:id` - удалить поток

### Отправка RTMP-потока

Для отправки RTMP-потока можно использовать OBS Studio или FFmpeg:

#### OBS Studio
1. Откройте OBS Studio
2. Перейдите в Настройки -> Вещание
3. Выберите "Пользовательский" сервис вещания
4. Введите URL сервера: `rtmp://localhost:1935/live`
5. Введите ключ потока, который был создан через веб-интерфейс или API

#### FFmpeg
```
ffmpeg -re -i <input-file-or-device> -c:v libx264 -preset veryfast -c:a aac -f flv rtmp://localhost:1935/live/<stream-key>
```

### Просмотр RTSP-потока

Для просмотра RTSP-потока можно использовать:

#### Встроенный веб-плеер
Веб-интерфейс включает встроенный RTSP-плеер с поддержкой WebRTC, который позволяет просматривать потоки прямо в браузере. Для использования:
1. Откройте страницу потока в веб-интерфейсе
2. Нажмите кнопку "Показать плеер" под RTSP URL
3. Плеер автоматически подключится к потоку, если он запущен

#### VLC
```
vlc rtsp://localhost:8554/live/<stream-key>
```

#### FFplay
```
ffplay rtsp://localhost:8554/live/<stream-key>
```

## Конфигурация

Конфигурация сервиса осуществляется через переменные окружения или файл `.env`:

- `PORT` - порт для веб-интерфейса (по умолчанию 3000)
- `RTMP_PORT` - порт для RTMP-сервера (по умолчанию 1935)
- `RTMP_CHUNK_SIZE` - размер чанка для RTMP (по умолчанию 60000)
- `RTSP_PORT` - порт для RTSP-сервера (по умолчанию 8554)
- `LOG_LEVEL` - уровень логирования (по умолчанию info)
- `FFMPEG_LOG_LEVEL` - уровень логирования FFmpeg (по умолчанию error)

## Архитектура

Сервис состоит из следующих компонентов:

1. **RTMP-сервер** - принимает входящие RTMP-потоки
2. **Конвертер** - преобразует RTMP в RTSP с помощью FFmpeg
3. **Менеджер потоков** - управляет несколькими потоками одновременно
4. **REST API** - предоставляет API для управления потоками
5. **Веб-интерфейс** - предоставляет пользовательский интерфейс для управления потоками

## Лицензия

ISC
